{"version":3,"file":"hw-12.js","sources":["../src/js/hw-12.js"],"sourcesContent":["const API_KEY =\n  '46463630-3c03a0f5bb3e2a02ee15ce5e1'; /* This should be kept a secret within Environmental Variables */\n\nconst lightbox = new SimpleLightbox(\n  '.gallery a#lightbox-link'\n); /* Fuck Lightbox and it's documentation BTW :) */\n\nconst State = {\n  searchQuery: null,\n  page: 1,\n  photos: [],\n  reset() {\n    this.searchQuery = null;\n    this.page = 1;\n    this.photos = [];\n  },\n};\n\nconst el = (tag, props) => Object.assign(document.createElement(tag), props);\n\nconst Gallery = {\n  element: document.querySelector('.gallery'),\n  clear() {\n    this.element.replaceChildren();\n  },\n  render(items) {\n    this.element.append(...(Array.isArray(items) ? items : [items]));\n  },\n  LoadMoreButton: {\n    element: el('button', {\n      className: 'btn',\n      textContent: 'Load more',\n      async onclick() {\n        const loader = Loader.create();\n        this.after(loader);\n        Gallery.LoadMoreButton.hide();\n\n        try {\n          const photosData = await Api.getPhotos(\n            State.searchQuery,\n            State.page + 1\n          );\n          State.page++;\n\n          const photoCards = photosData.hits\n            .map(toGalleryPhoto)\n            .map(createCard)\n            .map(applyLightbox);\n\n          State.photos.push(...photoCards);\n\n          loader.remove();\n          Gallery.render(State.photos);\n\n          scrollDownByTwoCardsHeights();\n\n          const areMorePhotosAvailable =\n            State.photos.length < photosData.totalHits;\n          if (areMorePhotosAvailable) {\n            Gallery.LoadMoreButton.show();\n          } else {\n            Toaster.info(\n              \"We're sorry, but you've reached the end of search results.\"\n            );\n          }\n        } catch (error) {\n          Toaster.error(`Sorry, couldn't load images. Please try again later!`);\n        } finally {\n          lightbox.refresh();\n        }\n      },\n    }),\n    show() {\n      Gallery.element.after(this.element);\n    },\n    hide() {\n      this.element.remove();\n    },\n  },\n};\n\nconst Toaster = {\n  error(message) {\n    iziToast.error({ message, position: 'topRight' });\n  },\n  info(message) {\n    iziToast.info({ message, position: 'topRight' });\n  },\n};\n\nconst Api = {\n  async getPhotos(searchQuery, page = 1) {\n    const params = new URLSearchParams({\n      key: API_KEY,\n      q: searchQuery,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page,\n      per_page: 40,\n    });\n\n    const response = await axios.get(`https://pixabay.com/api/`, { params });\n    console.log(response.data);\n    return response.data;\n  },\n};\n\nconst Loader = {\n  create() {\n    return el('div', { className: 'loader' });\n  },\n};\n\ndocument\n  .querySelector('form#image-search')\n  .addEventListener('submit', async event => {\n    event.preventDefault();\n    const form = event.target;\n    const searchQuery = form.elements['query'].value;\n    form.reset();\n\n    Gallery.LoadMoreButton.hide();\n    Gallery.clear();\n    Gallery.render(Loader.create());\n\n    State.reset();\n\n    try {\n      const photosData = await Api.getPhotos(searchQuery);\n      State.searchQuery = searchQuery;\n\n      if (photosData.hits.length === 0) {\n        Toaster.error(\n          'Sorry, there are no images matching your search query. Please try again!'\n        );\n        Gallery.clear();\n        return;\n      }\n\n      const photoCards = photosData.hits\n        .map(toGalleryPhoto)\n        .map(createCard)\n        .map(applyLightbox);\n\n      State.photos.push(...photoCards);\n\n      Gallery.clear();\n      Gallery.render(photoCards);\n\n      const areMorePhotosAvailable = State.photos.length < photosData.totalHits;\n      if (areMorePhotosAvailable) {\n        Gallery.LoadMoreButton.show();\n      } else {\n        Toaster.info(\n          \"We're sorry, but you've reached the end of search results.\"\n        );\n      }\n    } catch (error) {\n      Toaster.error(`Sorry, couldn't load images. Please try again later!`);\n      Gallery.clear();\n    } finally {\n      lightbox.refresh();\n    }\n  });\n\nconst toGalleryPhoto = ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n}) => ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n});\n\nconst createCard = ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n}) => {\n  const template = document.querySelector('template#card-template');\n  const card = document.importNode(template.content, true);\n\n  const lightboxLink = card.querySelector('a#lightbox-link');\n  lightboxLink.href = largeImageURL;\n\n  const img = card.querySelector('img.card-img');\n  img.src = webformatURL;\n  img.alt = tags;\n  img.title = tags;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"likes\"]`\n  ).textContent = likes;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"views\"]`\n  ).textContent = views;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"comments\"]`\n  ).textContent = comments;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"downloads\"]`\n  ).textContent = downloads;\n\n  return card;\n};\n\nconst applyLightbox = card => {\n  card.querySelector('a#lightbox-link').addEventListener('click', event => {\n    event.preventDefault();\n\n    const closeModalOnEscape = event => {\n      if (event.key === 'Escape') {\n        document.removeEventListener('keydown', closeModalOnEscape);\n        lightbox.close();\n      }\n    };\n\n    document.addEventListener('keydown', closeModalOnEscape);\n\n    lightbox.open(event.currentTarget);\n  });\n\n  return card;\n};\n\nconst scrollDownByTwoCardsHeights = () => {\n  const height = document.querySelector('.card').getBoundingClientRect().height;\n  scrollBy(0, 2 * height, { behavior: 'smooth' });\n};\n"],"names":["API_KEY","lightbox","State","el","tag","props","Gallery","items","loader","Loader","photosData","Api","photoCards","toGalleryPhoto","createCard","applyLightbox","scrollDownByTwoCardsHeights","Toaster","message","searchQuery","page","params","response","event","form","webformatURL","largeImageURL","tags","likes","views","comments","downloads","template","card","lightboxLink","img","closeModalOnEscape","height"],"mappings":"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"}