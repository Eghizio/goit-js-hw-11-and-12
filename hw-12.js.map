{"version":3,"file":"hw-12.js","sources":["../src/js/gallery/TogglableElement.js","../src/js/gallery/State.js","../src/js/gallery/Toaster.js","../src/js/gallery/Api.js","../src/js/gallery/Gallery.js","../src/js/hw-12.js"],"sourcesContent":["export class TogglableElement {\n  #element;\n\n  constructor(selector) {\n    this.#element = document.querySelector(selector);\n  }\n\n  getElement() {\n    return this.#element;\n  }\n\n  show() {\n    this.#element.disabled = false;\n    this.#element.classList.remove('hidden');\n  }\n\n  hide() {\n    this.#element.disabled = true;\n    this.#element.classList.add('hidden');\n  }\n}\n","export class State {\n  #_searchQuery;\n  #_page;\n  #_photos;\n\n  constructor(\n    { searchQuery, page, photos } = {\n      searchQuery: undefined,\n      page: undefined,\n      photos: undefined,\n    }\n  ) {\n    this.#_searchQuery = searchQuery ?? null;\n    this.#_page = page ?? 1;\n    this.#_photos = photos ?? [];\n  }\n\n  get searchQuery() {\n    return this.#_searchQuery;\n  }\n\n  get page() {\n    return this.#_page;\n  }\n\n  get photos() {\n    return this.#_photos;\n  }\n\n  reset() {\n    this.#_searchQuery = null;\n    this.#_page = 1;\n    this.#_photos = [];\n  }\n\n  setSearchQuery(query) {\n    const isNewSearchQuery = this.#_searchQuery !== query;\n\n    if (isNewSearchQuery) {\n      this.reset();\n      this.#_searchQuery = query;\n    } else {\n      this.nextPage();\n    }\n  }\n\n  nextPage() {\n    this.#_page++;\n  }\n\n  addPhotos(photos) {\n    this.#_photos.push(...photos);\n  }\n}\n","export const Toaster = {\n  error(message) {\n    iziToast.error({ message, position: 'topRight' });\n  },\n  info(message) {\n    iziToast.info({ message, position: 'topRight' });\n  },\n};\n","const API_KEY =\n  '46463630-3c03a0f5bb3e2a02ee15ce5e1'; /* This should be kept a secret within Environmental Variables */\n\nexport const Api = {\n  async getPhotos(searchQuery, page = 1) {\n    const params = new URLSearchParams({\n      key: API_KEY,\n      q: searchQuery,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page,\n      per_page: 40,\n    });\n\n    const response = await axios.get(`https://pixabay.com/api/`, { params });\n    return response.data;\n  },\n};\n","import { State } from './State.js';\nimport { Toaster } from './Toaster.js';\nimport { Api } from './Api.js';\n\nexport class Gallery {\n  #state;\n  #element;\n  #lightbox;\n  #loader;\n  #loadMoreBtn;\n\n  constructor(selector, lightbox, loader, loadMoreBtn) {\n    this.#state = new State();\n    this.#element = document.querySelector(selector);\n    this.#lightbox = lightbox;\n    this.#loader = loader;\n    this.#loadMoreBtn = loadMoreBtn;\n  }\n\n  clear() {\n    this.#element.replaceChildren();\n  }\n\n  async loadPhotos(searchQuery) {\n    this.#state.setSearchQuery(searchQuery);\n\n    this.#loadMoreBtn.hide();\n    this.#loader.show();\n    const isGalleryEmpty = this.#state.photos.length === 0;\n\n    try {\n      const photosData = await Api.getPhotos(\n        this.#state.searchQuery,\n        this.#state.page\n      );\n\n      if (photosData.hits.length === 0) {\n        if (!isGalleryEmpty) {\n          Toaster.info(\n            \"We're sorry, but you've reached the end of search results.\"\n          );\n          return;\n        }\n\n        Toaster.error(\n          'Sorry, there are no images matching your search query. Please try again!'\n        );\n        this.clear();\n        this.#loader.hide();\n        return;\n      }\n\n      this.#state.addPhotos(photosData.hits);\n\n      this.#loader.hide();\n      this.#renderPhotos();\n\n      if (!isGalleryEmpty) scrollDownByTwoCardsHeights();\n\n      const areMorePhotosAvailable =\n        this.#state.photos.length < photosData.totalHits;\n\n      if (areMorePhotosAvailable) {\n        this.#loadMoreBtn.show();\n      } else {\n        Toaster.info(\n          \"We're sorry, but you've reached the end of search results.\"\n        );\n      }\n    } catch (error) {\n      Toaster.error(`Sorry, couldn't load images. Please try again later!`);\n      this.#loader.hide();\n    } finally {\n      this.#lightbox.refresh();\n    }\n  }\n\n  #renderPhotos() {\n    const photoCards = this.#state.photos.map(\n      this.#mapPhotoToElement.bind(this)\n    );\n\n    this.#element.replaceChildren(...photoCards);\n  }\n\n  #mapPhotoToElement(photo) {\n    return applyLightbox(createCard(toGalleryPhoto(photo)), this.#lightbox);\n  }\n}\n\nconst toGalleryPhoto = ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n}) => ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n});\n\nconst createCard = ({\n  webformatURL,\n  largeImageURL,\n  tags,\n  likes,\n  views,\n  comments,\n  downloads,\n}) => {\n  const template = document.querySelector('template#card-template');\n  const card = document.importNode(template.content, true);\n\n  const lightboxLink = card.querySelector('a#lightbox-link');\n  lightboxLink.href = largeImageURL;\n\n  const img = card.querySelector('img.card-img');\n  img.src = webformatURL;\n  img.alt = tags;\n  img.title = tags;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"likes\"]`\n  ).textContent = likes;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"views\"]`\n  ).textContent = views;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"comments\"]`\n  ).textContent = comments;\n\n  card.querySelector(\n    `span.card-stats-item-count[data-item=\"downloads\"]`\n  ).textContent = downloads;\n\n  return card;\n};\n\nconst applyLightbox = (card, lightbox) => {\n  card.querySelector('a#lightbox-link').addEventListener('click', event => {\n    event.preventDefault();\n\n    const closeModalOnEscape = event => {\n      if (event.key === 'Escape') {\n        document.removeEventListener('keydown', closeModalOnEscape);\n        lightbox.close();\n      }\n    };\n\n    document.addEventListener('keydown', closeModalOnEscape);\n\n    lightbox.open(event.currentTarget);\n  });\n\n  return card;\n};\n\nexport const scrollDownByTwoCardsHeights = () => {\n  const height = document.querySelector('.card').getBoundingClientRect().height;\n  scrollBy(0, 2 * height, { behavior: 'smooth' });\n};\n","import { TogglableElement } from './gallery/TogglableElement.js';\nimport { Gallery } from './gallery/Gallery.js';\n\nconst main = () => {\n  /* Fuck Lightbox and it's documentation BTW :) */\n  const lightbox = new SimpleLightbox('.gallery a#lightbox-link');\n  const loader = new TogglableElement('div.loader');\n  const loadMoreButton = new TogglableElement(`button[type=\"button\"].btn`);\n\n  const gallery = new Gallery('.gallery', lightbox, loader, loadMoreButton);\n  let query;\n\n  document\n    .querySelector('form#image-search')\n    .addEventListener('submit', async event => {\n      event.preventDefault();\n      const form = event.target;\n      const searchQuery = form.elements['query'].value;\n      form.reset();\n\n      query = searchQuery;\n      await gallery.loadPhotos(searchQuery);\n    });\n\n  loadMoreButton\n    .getElement()\n    .addEventListener('click', () => gallery.loadPhotos(query));\n};\n\nmain();\n"],"names":["TogglableElement","selector","__privateAdd","_element","__privateSet","__privateGet","State","searchQuery","page","photos","__searchQuery","__page","__photos","query","__privateWrapper","Toaster","message","API_KEY","Api","params","Gallery","lightbox","loader","loadMoreBtn","_Gallery_instances","_state","_lightbox","_loader","_loadMoreBtn","isGalleryEmpty","photosData","__privateMethod","renderPhotos_fn","scrollDownByTwoCardsHeights","photoCards","mapPhotoToElement_fn","photo","applyLightbox","createCard","toGalleryPhoto","webformatURL","largeImageURL","tags","likes","views","comments","downloads","template","card","lightboxLink","img","event","closeModalOnEscape","height","main","loadMoreButton","gallery","form"],"mappings":"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"}